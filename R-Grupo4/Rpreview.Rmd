---
title: "R Notebook"
output: html_notebook
---

EXTRACCIÓN DE DATOS

Para comenzar, hemos trabajado esta parte de la práctica con datos extraídos de la web de datos abiertos de la Comunidad de Madrid, en concreto de los Accidentes de tráfico con implicación de bicicletas en 2018. 
Para ello, creamos las funciones y vemos el archivo (previamente instalamos y ejecutamos la librería "tidyverse"):

```{r}
install.packages("tidyverse")
library(readxl)
AccidentesBicicletas_2018 <- read_excel("AccidentesBicicletas_2018.xlsx")
View(AccidentesBicicletas_2018)
```

Para saber el nombre de las columnas

```{r}
colnames(AccidentesBicicletas_2018)
```
Para saber el resumen de los datos
```{r}
str(AccidentesBicicletas_2018)
```

Hacemos una copia de la tabla original para trabajar con los datos
```{r}
accidente <- AccidentesBicicletas_2018
```

Elimninamos las columnas que creemos que no van a ser necesarias para el tratamiento de datos.

```{r}
accidente$"CPFA Lluvia" <- NULL
accidente$"CPFA Granizo" <- NULL
accidente$"CPFA Lluvia" <- NULL
accidente$"CPFA Hielo" <- NULL
accidente$"CPFA Niebla" <- NULL
accidente$"CPFA Nieve" <- NULL
accidente$"CPFA Mojada" <- NULL
accidente$"CPFA Aceite" <- NULL
accidente$"CPFA Barro" <- NULL
accidente$"CPSV Mojada" <- NULL
accidente$"CPSV Aceite" <- NULL
accidente$"CPSV Barro" <- NULL
accidente$"CPSV Grava Suelta" <- NULL
accidente$"CPSV Hielo" <- NULL
accidente$"Nº" <- NULL
accidente$"CPSV Seca Y Limpia" <- NULL
accidente$LESIVIDAD <- NULL
accidente$`CPFA Seco` <- NULL
```

Con esta función dejamos la copia de la tabla con 12 variables

```{r}
colnames(accidente)
```

Cambiamos el nombre a todas las columnas 

```{r}
names(accidente) <- c("Fecha", "Rango Horario", "Dia Semana", "Distrito", "Lugar Accidente", "Numero Parte","Numero Victimas",
                      "Tipo Accidente","Tipo Vehiculo","Tipo Persona","Sexo","Tramo Edad"  )
```

Con la siguiente funcion obtenemos la gráfica y el número de hombres, mujeres y género no asigando que han tenido accidentes (pudiendo visualizar la consola de R y un diagrama de barras)

```{r}
fsexo = as.factor(accidente$Sexo)
fsexo
levels(fsexo)
summary(fsexo)
plot(fsexo)
```

CON UN TOTAL DE 547 HOMBRES, 142 MUJERES Y UN TOTAL DE 11 NO ASIGNADOS

De la misma forma que en el caso anterior, con la siguiente función, hemos averiguado cuál es el  rango horario con mayor número de accidentes de bicicleta.
```{r}
fhoras = as.factor(accidente$`Rango Horario`)
fhoras
levels(fhoras)
summary(fhoras)
plot(fhoras)
```

 EL RANGO HORARIO CON MAYOR NUMERO DE ACCIDENTES ES DE 19:00 A 19:50

Calculamos el número medio y el número máximo de víctimas sobre todo el conjunto de accidente

```{r}
sapply(accidente[, 7], mean, na.rm = TRUE)
```
```{r}
sapply(accidente[, 7], max, na.rm = TRUE)
```

Con esta funcion hemos cambiado el formato de la fecha a Dia, Mes y Año

```{r}
fecha <- accidente$Fecha
fecha
format(fecha, format = "%d/%m/%y")
```

El formato antiguo que presenta la tabla de datos es : 2018-01-01 / Aplicando la fórmula mencionada arriba arriba los datos quedan representados así : "01/01/18"

Ahora organizamos la gráfica de accidentes/días de la semana correctamente de Lunes a Domingo, puesto que la original no llevaba un orden adecuado.
```{r}
# Realizamos la impresion de la grafica y nos damos cuenta de que estan desorganizados los dias de la semana

fdia = as.factor(accidente$`Dia Semana`)
fdia
levels(fdia)
summary(fdia)
plot(fdia)

# Para poder organizar los datos necesitamos cambiar a factor la variable: 
  
fechas2 <- as.factor(accidente$`Dia Semana`)

# ver como está ordenada
levels(fechas2)

# confirmar que tiene 7 niveles
nlevels(fechas2)
summary(fechas2)

# ordenar correctamente
fechas2 = factor(accidente$`Dia Semana`, levels = c("LUNES", "MARTES", "MIERCOLES", "JUEVES", "VIERNES", "SABADO", "DOMINGO"))

# confirmar que está ordenada
levels(fechas2)
summary(fechas2)
plot(fechas2)

```


